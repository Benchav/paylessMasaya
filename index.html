<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Payless — Login</title>
<style>
:root{--bg:#0f1724;--accent:#ff6b35;--muted:#98a0b3}
body{margin:0;font-family:Inter,system-ui;display:flex;align-items:center;justify-content:center;height:100vh;background:#0f1724;color:#e6eef8}
.card{width:420px;background:rgba(255,255,255,0.02);border-radius:12px;padding:22px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
.brand{display:flex;gap:12px;margin-bottom:16px}
.logo{width:48px;height:48px;border-radius:10px;background:var(--accent);display:flex;align-items:center;justify-content:center;color:#071022;font-weight:700}
h1{margin:0;font-size:18px}
p.lead{margin:6px 0 16px;font-size:13px;color:var(--muted)}
.form-group{display:flex;flex-direction:column;gap:6px;margin-bottom:12px}
label{font-size:13px;color:var(--muted)}
input{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.actions{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:8px}
.btn{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),#ff8a5b);border:none;color:#071022}
.muted{color:var(--muted);font-size:13px}
.msg{height:18px;font-size:13px;margin-top:6px}
.loading{opacity:0.7}
</style>
</head>
<body>
<div class="card">
  <div class="brand">
    <div class="logo">PS</div>
    <div>
      <h1>Payless SUC Masaya — Iniciar sesión</h1>
      <p class="lead">Conéctate con la API</p>
    </div>
  </div>

  <form id="loginForm" autocomplete="on">
    <div class="form-group">
      <label for="username">Usuario</label>
      <input id="username" name="username" type="text" placeholder="usuario" required />
    </div>
    <div class="form-group">
      <label for="password">Contraseña</label>
      <input id="password" name="password" type="password" placeholder="••••••••" required minlength="6" />
    </div>
    <div class="actions">
      <button id="submitBtn" type="submit" class="btn primary">Entrar</button>
      <button type="button" id="demoBtn" class="btn">Usar demo</button>
    </div>
    <div class="muted">¿No tienes cuenta? <a class="link" href="register.html">Regístrate</a></div>
    <div class="msg" id="msg"></div>
  </form>
</div>

<script>
const API_BASE = 'https://payless-api.vercel.app';
const LOGIN_PATH = '/auth/login';
const STORAGE_AUTH = 'payless_auth_v1';

function showMsg(text, ok){ 
  const el = document.getElementById('msg'); 
  el.textContent = text; 
  el.style.color = ok ? '#9fe6b0' : '#ffb4a2'; 
}

function setAuthToken(obj){ 
  localStorage.setItem(STORAGE_AUTH, JSON.stringify(obj)); 
}

async function apiLogin(username, password){
  const res = await fetch(API_BASE + LOGIN_PATH, {
    method:'POST',
    headers:{ 'Content-Type':'application/json' },
    body: JSON.stringify({ username, password })
  });
  const data = await res.json().catch(()=>null);
  if(!res.ok) throw new Error(data?.message || 'Error ' + res.status);
  return data;
}

document.getElementById('loginForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  if(!username || !password){ showMsg('Completa los campos', false); return; }

  const btn = document.getElementById('submitBtn');
  btn.disabled = true; btn.classList.add('loading');
  showMsg('Conectando...', true);

  try{
    const result = await apiLogin(username, password);
    if(!result.token) throw new Error('Token no recibido');

    const user = { username };
    setAuthToken({ token: result.token, user });
    showMsg('Inicio de sesión correcto. Redirigiendo...', true);

    // Redirigir al panel
    setTimeout(()=> window.location.href='panelMasaya.html', 600);
  }catch(err){
    console.error(err);
    showMsg(err.message || 'Error en login', false);
  }finally{
    btn.disabled = false; btn.classList.remove('loading');
  }
});

document.getElementById('demoBtn').addEventListener('click', ()=>{
  document.getElementById('username').value='adminmasaya';
  document.getElementById('password').value='123456';
  document.getElementById('loginForm').dispatchEvent(new Event('submit',{cancelable:true,bubbles:true}));
});
</script>
</body>
</html>